<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
<title>JSSpec results</title>
<link rel="stylesheet" type="text/css" href="lib/JSSpec.css" />
<script type="text/javascript" src="lib/diff_match_patch.js"></script>
<script type="text/javascript" src="lib/JSSpec.js"></script>

<script type="text/javascript" src="../src/jack.js"></script>
<script type="text/javascript">// <![CDATA[

	describe('Jack API', {
		before_all: function() {
			jack.env.disableReporting();
		}
		,
		after_all: function() {
			jack.env.enableReporting();
		}
		,
		'Should have a global jack() function': function() {
			value_of(typeof jack).should_be("function");
		}
		,
		'Should take a function as parameter and run it': function() {
			var functionHasBeenRun = false;
			jack(function(){
				functionHasBeenRun = true;
			});
			value_of(functionHasBeenRun).should_be_true();
		}
		,
		'Should be able to grab a global function and know if it has been run': function() {
			var realFunctionHasBeenRun = false;
			globalTestFunction = function() {
				realFunctionHasBeenRun = true;
			}
			
			jack(function(){
				jack.grab("globalTestFunction");
				globalTestFunction();
			});
			
			value_of(realFunctionHasBeenRun).should_be_true();
			value_of(jack.examine("globalTestFunction").times()).should_be(1);
			
			delete globalTestFunction;
		}
		,
		'Should call grabbed functions with same arguments': function() {
			var calledParameter1 = "";
			var calledParameter2 = "";
			globalTestFunction = function(p1, p2) {
				calledParameter1 = p1;
				calledParameter2 = p2;
			}
			
			jack(function(){
				jack.grab("globalTestFunction");
				globalTestFunction("value1","value2");
			});
			
			value_of(calledParameter1).should_be("value1");
			value_of(calledParameter2).should_be("value2");
			
			delete globalTestFunction;
		}
		,
		'Should call grabbed functions with same this reference': function() {
			var expectedThis = "This is this!";
			var calledThis = null;
			globalTestFunction = function(p1, p2) {
				calledThis = this;
			}
			
			jack(function(){
				jack.grab("globalTestFunction");
				globalTestFunction.call(expectedThis);
			});
			
			value_of(calledThis).should_be(expectedThis);
			
			delete globalTestFunction;
		}
		,
		'Should reset global functions when finished': function() {
			var realFunctionHasBeenRun = false;
			globalTestFunction = function() {}
			var referenceToGlobalTestFunction = globalTestFunction;
			
			jack(function(){
				value_of(globalTestFunction === referenceToGlobalTestFunction).should_be_true();
				jack.grab("globalTestFunction");
				value_of(globalTestFunction === referenceToGlobalTestFunction).should_be_false();
			});
			
			value_of(globalTestFunction === referenceToGlobalTestFunction).should_be_true();
			
			delete globalTestFunction;
		}
		,
		'Should be able to grab all of an objects functions': function() {
			var realFunctionOneHasBeenRun = false;
			var realFunctionTwoHasBeenRun = false;
			var realFunctionThreeHasBeenRun = false;
			globalObject = {};
			globalObject.functionOne = function() { realFunctionOneHasBeenRun = true; }
			globalObject.functionTwo = function() { realFunctionTwoHasBeenRun = true; }
			globalObject.functionThree = function() { realFunctionThreeHasBeenRun = true; }
			
			jack(function(){
				jack.grab("globalObject");
				globalObject.functionOne();
				globalObject.functionTwo();
				globalObject.functionTwo();
			});
			
			value_of(realFunctionOneHasBeenRun).should_be_true();
			value_of(realFunctionTwoHasBeenRun).should_be_true();
			value_of(realFunctionThreeHasBeenRun).should_be_false();
			value_of(jack.examine("globalObject.functionOne").times()).should_be(1);
			value_of(jack.examine("globalObject.functionTwo").times()).should_be(2);
			value_of(jack.examine("globalObject.functionThree").times()).should_be(0);
			
			delete globalObject;
		}
		,
		'Should reset global objects function when finished': function() {
			globalObject = {};
			globalObject.functionOne = function() {}
			globalObject.functionTwo = function() {}
			globalObject.functionThree = function() {}
			var functionOneReference = globalObject.functionOne;
			var functionTwoReference = globalObject.functionTwo;
			var functionThreeReference = globalObject.functionThree;
			
			jack(function(){
				value_of(globalObject.functionOne === functionOneReference).should_be_true();
				value_of(globalObject.functionTwo === functionTwoReference).should_be_true();
				value_of(globalObject.functionThree === functionThreeReference).should_be_true();
				jack.grab("globalObject");
				value_of(globalObject.functionOne === functionOneReference).should_be_false();
				value_of(globalObject.functionTwo === functionTwoReference).should_be_false();
				value_of(globalObject.functionThree === functionThreeReference).should_be_false();
			});
			
			value_of(globalObject.functionOne === functionOneReference).should_be_true();
			value_of(globalObject.functionTwo === functionTwoReference).should_be_true();
			value_of(globalObject.functionThree === functionThreeReference).should_be_true();
			
			delete globalObject;
		}
		,
		'Should be able to grab one of an objects functions': function() {
			var realFunctionOneHasBeenRun = false;
			var realFunctionTwoHasBeenRun = false;
			var realFunctionThreeHasBeenRun = false;
			globalObject = {};
			globalObject.functionOne = function() { realFunctionOneHasBeenRun = true; }
			globalObject.functionTwo = function() { realFunctionTwoHasBeenRun = true; }
			globalObject.functionThree = function() { realFunctionThreeHasBeenRun = true; }
			
			jack(function(){
				jack.grab("globalObject.functionTwo");
				globalObject.functionOne();
				globalObject.functionTwo();
			});
			
			value_of(realFunctionOneHasBeenRun).should_be_true();
			value_of(realFunctionTwoHasBeenRun).should_be_true();
			value_of(realFunctionThreeHasBeenRun).should_be_false();
			value_of(jack.examine("globalObject.functionTwo").times()).should_be(1);
			value_of(jack.examine("globalObject.functionThree")).should_be_undefined();
			value_of(jack.examine("globalObject.functionOne")).should_be_undefined();
			
			delete globalObject;
		}
		,
		'Should report how well expectations are met': function() {			
			bowlingGame = { roll:function(){}, score:function(){} };
			functionOne = function() {}
			functionTwo = function() {}
			
			jack(function(){
				jack.grab("bowlingGame");
				jack.expect("bowlingGame.roll");
				bowlingGame.score();
				
				jack.grab("functionOne");
				jack.grab("functionTwo");
				jack.expect("functionOne");
				functionOne();
				functionTwo();
				functionTwo();
			});
			
			value_of(jack.report("bowlingGame.roll")).should_be({
				expected: 1,
				actual: 0,
				success: false,
				fail: true
			});
			value_of(jack.report("bowlingGame.score")).should_be({
				expected: 0,
				actual: 1,
				success: false,
				fail: true
			});
			value_of(jack.report("functionOne")).should_be({
				expected: 1,
				actual: 1,
				success: true,
				fail: false
			});
			value_of(jack.report("functionTwo")).should_be({
				expected: 0,
				actual: 2,
				success: false,
				fail: true
			});
			
			delete bowlingGame;
			delete functionOne;
			delete functionTwo;
		}
		,
		'Should start fresh when jack() is called a second time': function() {
			globalTestFunction = function() { }
			
			jack(function(){
				jack.grab("globalTestFunction");
				globalTestFunction();
			});
			value_of(jack.examine("globalTestFunction").times()).should_be(1);
			
			jack(function(){
				// do nothing
			});
			value_of(jack.examine("globalTestFunction")).should_be_undefined();
			
			delete globalTestFunction;
		}
		,
		'Should be able to specify mock implementations': function() {
			var realJQueryAjaxCalled = false;
			var mockJQueryAjaxCalled = false;
			var expectedReturnValue = "Return value";
			var actualReturnValue = "";
			jQuery = { 
				ajax:function(){ realJQueryAjaxCalled = true; }
			}
			
			jack(function(){
				jack.grab("jQuery.ajax").mock(function(){
					mockJQueryAjaxCalled = true;
					return expectedReturnValue;
				});
				actualReturnValue = jQuery.ajax();
			});
			
			value_of(realJQueryAjaxCalled).should_be_false();
			value_of(mockJQueryAjaxCalled).should_be_true();
			value_of(actualReturnValue).should_be(expectedReturnValue);
			
			delete jQuery;
		}
		,
		'Should call mock implementations with same arguments': function() {
			var calledParameter1 = "";
			var calledParameter2 = "";
			jQuery = { 
				ajax:function(p1, p2){}
			}
			
			jack(function(){
				jack.grab("jQuery.ajax").mock(function(p1, p2){
					calledParameter1 = p1;
					calledParameter2 = p2;
				});
				jQuery.ajax("value1","value2");
			});
			
			value_of(calledParameter1).should_be("value1");
			value_of(calledParameter2).should_be("value2");

			delete jQuery;
		}
		,
		'Should call mock implementations with same this reference': function() {
			var expectedThis = "This is this!";
			var calledThis = null;
			jQuery = { 
				ajax:function(){}
			}
			
			jack(function(){
				jack.grab("jQuery.ajax").mock(function(){
					calledThis = this;
				});
				jQuery.ajax.call(expectedThis);
			});
			
			value_of(calledThis).should_be(expectedThis);

			delete jQuery;
		}
		,
		'Should not have to call grab() before expect()': function() {
			globalFunction = function() {}
			
			jack(function(){
				jack.expect("globalFunction");
			});
			
			var report = jack.report("globalFunction");
			value_of(report.expected).should_be(1);
			
			delete globalFunction;
		}		
	});
	
	
	
	describe('Setting expectations for number of expected calls', {
		before_all: function() {
			jack.env.disableReporting();
		}
		,
		after_all: function() {
			jack.env.enableReporting();
		}
		,
		'Should be able to specify exact number of expected calls': function() {
			globalFunction = function() {}
			
			jack(function(){
				jack.expect("globalFunction").exactly(3);
			});
			
			var report = jack.report("globalFunction");
			value_of(report.expected).should_be(3);
			
			delete globalFunction;
		}
	});
	
	
	describe('JSSpec integration',{
		'Should know when JSSpec is in environment': function() {
			value_of(jack.env.isJSSpec()).should_be_true();
		}
		,
		'Should know when JSSpec not is in environment': function() {
			var _jsspec = window.JSSpec;
			window.JSSpec = null;
			var result = jack.env.isJSSpec();
			window.JSSpec = _jsspec;
			value_of(result).should_be_false();
		}
		,
		'Should report unmet expectations to value_of().should_fail()': function() {
			var failMessage = "";
			var _valueof = value_of;
			value_of = function() {
				return {
					should_fail: function(msg) {
						failMessage = msg;
					}
				}
			}
			
			globalFunction = function() {};
			jack(function(){
				jack.grab("globalFunction");
				jack.expect("globalFunction").once();
			});
			
			value_of = _valueof;
			value_of(failMessage).should_be("Expectation failed: globalFunction() was expected 1 time(s), but was called 0 time(s).");
			
			delete globalFunction;
		}
	});



	/*
	describe('Integration with Scriptaculous testrunner (NOT IMPLEMENTED)',{
	});




	describe('Integration with JsUnit (NOT IMPLEMENTED)',{
	});
	*/























// ]]></script>
</head>
<body><div style="display:none;"><p>A</p><p>B</p></div></body>
</html>